<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="//cdn.jsdelivr.net/npm/phaser@3.1.1/dist/phaser.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <style>
      .player { position: relative; height: 30px; width: 30px; background-color: red; }
      #canvas { background-color: grey; width:1000px; height: 1000px; }
    </style>
  </head>
  <body>
    <div>
      To join this game visit http://localhost:3000 with your mobile phone.
    </div>

    <div id="canvas"></div>
  </body>
  <script type="text/javascript">

var socket = new WebSocket('ws://localhost:3000/ws/display');

socket.addEventListener('open', function(event) {
  console.log('got open', event);
});


socket.onmessage = function(raw_event) {
  event = JSON.parse(raw_event.data);
  console.log('got event', event)
  switch(event.type) {
    case "new-player":
      playerId = event.player.id;
      console.log('New Player', playerId)
      $('#canvas').append("<div id='" + playerId + "' " + "class='player'></div>")
      $('#' + playerId).css({"top": event.player.x + "px", "left": event.player.y + "px"});
      break;
    default:
      console.log("Unknown event type", eventName)
  }

};

// send message to server
var socketPush  = function(message) {
  if (socket.readyState === WebSocket.OPEN) {
    console.log('sending msg', message);
    socket.send(message);
  }
};
  </script>

</html>
