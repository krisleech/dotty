<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="//cdn.jsdelivr.net/npm/phaser@3.1.1/dist/phaser.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="/jquery-3.3.1.min.js"></script>
  </head>
  <body>
    <h1>Controls</h1>
    <div>
    </div>

    <div id="controls">
      <a href="#" id="up" class="control">Up</a>
      <a href="#" id="right" class="control">Right</a>
      <a href="#" id="down" class="control">Down</a>
      <a href="#" id="left" class="control">Left</a>
    </div>
  </body>
  <script type="text/javascript">

$('#up').click(function(e) {
  e.preventDefault();
  sendEvent({ "type": "move", "direction": "up" });
})

$('#down').click(function(e) {
  e.preventDefault();
  sendEvent({ "type": "move", "direction": "down" });
})

$('#left').click(function(e) {
  e.preventDefault();
  sendEvent({ "type": "move", "direction": "left" });
})

$('#right').click(function(e) {
  e.preventDefault();
  sendEvent({ "type": "move", "direction": "right" });
})

var socket = new WebSocket('ws://localhost:3000/ws/player');

socket.addEventListener('open', function(event) {
  console.log('player got open', event);
});

var playerId;

socket.onmessage = function(message) {
  event = JSON.parse(message.data);
  console.log('event received', event)

  switch(event.type) {
    case "id-created":
      playerId = event.id;
      console.log('id set', playerId)
      break;
    default:
      console.log("Unknown event type", event.type)
  }


};

// send message to server
var sendEvent  = function(event) {
  if (socket.readyState === WebSocket.OPEN) {
    event['player-id'] = playerId;
    console.log('event sent', event);
    json = JSON.stringify(event);
    socket.send(json);
  }
};
  </script>

</html>
